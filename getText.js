odt = '<?xml version="1.0" encoding="UTF-8"?><office:document-content xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:formx="urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:officeooo="http://openoffice.org/2009/office" office:version="1.3"><office:scripts/><office:font-face-decls><style:font-face style:name="Lucida Sans1" svg:font-family="&apos;Lucida Sans&apos;" style:font-family-generic="swiss"/><style:font-face style:name="Liberation Serif" svg:font-family="&apos;Liberation Serif&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="Liberation Sans" svg:font-family="&apos;Liberation Sans&apos;" style:font-family-generic="swiss" style:font-pitch="variable"/><style:font-face style:name="Lucida Sans" svg:font-family="&apos;Lucida Sans&apos;" style:font-family-generic="system" style:font-pitch="variable"/><style:font-face style:name="Microsoft YaHei" svg:font-family="&apos;Microsoft YaHei&apos;" style:font-family-generic="system" style:font-pitch="variable"/><style:font-face style:name="NSimSun" svg:font-family="NSimSun" style:font-family-generic="system" style:font-pitch="variable"/></office:font-face-decls><office:automatic-styles><style:style style:name="P1" style:family="paragraph" style:parent-style-name="Standard"><style:text-properties officeooo:rsid="00051b72" officeooo:paragraph-rsid="00051b72"/></style:style><style:style style:name="P2" style:family="paragraph"><style:paragraph-properties fo:text-align="start"/><style:text-properties style:text-line-through-style="none" style:text-line-through-type="none" fo:font-style="normal" style:text-underline-style="none"/></style:style><style:style style:name="gr1" style:family="graphic"><style:graphic-properties style:wrap="run-through" style:number-wrapped-paragraphs="no-limit" style:vertical-pos="from-top" style:horizontal-pos="from-left" style:horizontal-rel="paragraph"/></style:style></office:automatic-styles><office:body><office:text><office:forms form:automatic-focus="false" form:apply-design-mode="false"><form:form form:name="Formulaire" form:apply-filter="true" form:command-type="table" form:control-implementation="ooo:com.sun.star.form.component.Form" office:target-frame=""><form:properties><form:property form:property-name="PropertyChangeNotificationEnabled" office:value-type="boolean" office:boolean-value="true"/><form:property form:property-name="TargetURL" office:value-type="string" office:string-value=""/></form:properties><form:text form:name="Zone de texte 1" form:control-implementation="ooo:com.sun.star.form.component.TextField" xml:id="control1" form:id="control1" form:input-required="false" form:convert-empty-to-null="true"><form:properties><form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/><form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.TextField"/><form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/></form:properties></form:text><form:text form:name="Zone de texte 1" form:control-implementation="ooo:com.sun.star.form.component.TextField" xml:id="control2" form:id="control2" form:current-value="aaaaaa" form:input-required="false" form:convert-empty-to-null="true"><form:properties><form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/><form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.TextField"/><form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/></form:properties></form:text></form:form></office:forms><text:sequence-decls><text:sequence-decl text:display-outline-level="0" text:name="Illustration"/><text:sequence-decl text:display-outline-level="0" text:name="Table"/><text:sequence-decl text:display-outline-level="0" text:name="Text"/><text:sequence-decl text:display-outline-level="0" text:name="Drawing"/><text:sequence-decl text:display-outline-level="0" text:name="Figure"/></text:sequence-decls><text:p text:style-name="P1">Test</text:p><text:p text:style-name="P1"><draw:control text:anchor-type="as-char" svg:y="-0.071cm" draw:z-index="0" draw:name="Forme1" draw:style-name="gr1" draw:text-style-name="P2" svg:width="5.167cm" svg:height="0.833cm" draw:control="control1"/></text:p><text:p text:style-name="P1">fgdsgfdgdfgdf</text:p><text:p text:style-name="P1"><draw:control text:anchor-type="as-char" svg:y="-0.071cm" draw:z-index="1" draw:name="Forme1_0" draw:style-name="gr1" draw:text-style-name="P2" svg:width="5.167cm" svg:height="0.833cm" draw:control="control2"/></text:p><text:p text:style-name="P1">sdfsdfsdfdsf</text:p></office:text></office:body></office:document-content>';
const parser = new DOMParser();
doc1 = parser.parseFromString(odt, "application/xml");
doc1.getElementsByTagName('form:text')
doc1.getElementsByTagName('form:text')[0].getAttribute('form:name');
doc1.getElementsByTagName('form:text')[0].getAttribute('form:id'); // xml:id (même valeur !)
doc1.getElementsByTagName('form:text')[0].getAttribute('form:label');
doc1.getElementsByTagName('form:text')[1].getAttribute('form:current-value');

// forms = doc1.getElementsByTagName('office:forms').getElementsByTagName('forms:forms');

// il est possible que le document contiennent plusieurs formulaires. Dans ce cas là on applique le traitement à chaque formulaire.
forms = doc1.getElementsByTagName('forms:forms');

struct = {
    "form:text": [
        "form:name",
        "form:id",
        "form:current-value",
    ],
    "form:checkbox": [
        "form:name",
        "form:id",
        "form:label",
        "form:current-state", // checked
        "form:is-tristate", // true
    ],
    "form:radio": [
        "form:name",
        "form:id",
        "form:label",
        "formx:group-name",
        "form:current-selected", // true
    ],
    "form:listbox": [
        "form:name",
        "form:id",
        "form:label",
        //<form:option form:label="a" form:current-selected="true"/>
    ],
}

// CLASS must be declared before use !

class Form_Element {
    getName(e) {
        return e.getAttribute('form:name');
    }
    getValue(e) {
        return undefined;
    }
    getId(e) {
        return e.getAttribute('form:id');
    }
}

forms = {
    "form:text": class extends Form_Element {
        getValue(e) {
            return e.getAttribute('current-value');
        }
    },
    "form:checkbox": class extends Form_Element {
        getName(e) {

        }
        getValue(e) {
            return e.getAttribute('current-state') == "checked" ? "[x]" : e.getAttribute('current-state') == "unknow" ? "[?]" : "[_]";
        }
    },
    "form:radio": class extends Form_Element {
        getValue(e) {
            // Autre méthode : doc1.querySelectorAll('radio[*|group-name="toto"][*|current-selected]');
            const attribute = e.getAttribute('formx:group-name') ? 'formx:group-name' : 'form:name';
            
            return Array.from(e.parentNode.getElementsByTagName('form:option'))
                .filter(x => x.getAttribute(attribute) == e.getAttribute(attribute) && x.getAttribute('form:current-selected') == 'true')
                .map(x => x.getAttribute('form:label'))
                .join(',');
        }
    },
    "form:listbox": class extends Form_Element {
        getValue(e) {
            // Autre méthode : Array.prototype.map.call(document.getElementsByTagName('div'), x=>x.innerHTML)
            return Array.from(e.getElementsByTagName('form:option'))
                .filter(x => x.getAttribute('form:current-selected') == 'true')
                .map(x => x.getAttribute('form:label'))
                .join(',');
        }
    },

}

/*

class Form_Element {
    constructor(e) {
        this.e = e;
    }
    getName() {

    }
    getValue() {

    }
    getId() {
        return this.e.getAttribute('form:id');
    }
}
*/

// Soit on passe par des classes instanciées, soit on passe par des méthodes statiques donc sans instanciation
// A voir ce qui sera le mieux sur le long terme
// classe instanciées : on créé l'objet avec la class qui dépend du type et on donne en paramètre le node
// classe non instanciée : on appelle la bonne classe, les méthodes statiques attendent en paramètre le node

// doc1.querySelectorAll('text') // need to filter to check if NS = form

// doc1.querySelectorAll('text')[1].namespaceURI

// doc1.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:form:1.0",'text')

// doc1.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:form:1.0",'*')

/* function nsResolver(prefix) {
  var ns = {
    'form' : 'urn:oasis:names:tc:opendocument:xmlns:form:1.0'
  };
  return ns[prefix] || null;
}
document.evaluate('//form:text',doc1,nsResolver).iterateNext()

// doc1.querySelectorAll('radio[*|group-name="toto"]');



*/

// l'ordre des controls est le même que celui du document
// AH NON PAS FORCEMENT

/*

            <office:forms form:automatic-focus="false" form:apply-design-mode="false">
                <form:form form:name="Formulaire" form:apply-filter="true" form:command-type="table" form:control-implementation="ooo:com.sun.star.form.component.Form" office:target-frame="">
                    <form:properties>
                        <form:property form:property-name="PropertyChangeNotificationEnabled" office:value-type="boolean" office:boolean-value="true"/>
                        <form:property form:property-name="TargetURL" office:value-type="string" office:string-value=""/>
                    </form:properties>
                    <form:text form:name="Zone de texte 1" form:control-implementation="ooo:com.sun.star.form.component.TextField" xml:id="control1" form:id="control1" form:input-required="false" form:convert-empty-to-null="true">
                        <form:properties>
                            <form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.TextField"/>
                            <form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/>
                        </form:properties>
                    </form:text>
                    <form:text form:name="Zone de texte 1" form:control-implementation="ooo:com.sun.star.form.component.TextField" xml:id="control2" form:id="control2" form:current-value="aaaaaa" form:input-required="false" form:convert-empty-to-null="true">
                        <form:properties>
                            <form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.TextField"/>
                            <form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/>
                        </form:properties>
                    </form:text>
                    <form:checkbox form:name="Case à cocher 1" form:control-implementation="ooo:com.sun.star.form.component.CheckBox" xml:id="control3" form:id="control3" form:label="Case à cocher" form:input-required="false" form:image-position="center">
                        <form:properties>
                            <form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.CheckBox"/>
                            <form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/>
                            <form:property form:property-name="SecondaryRefValue" office:value-type="string" office:string-value=""/>
                        </form:properties>
                    </form:checkbox>
                    <form:radio form:name="Bouton radio 1" form:control-implementation="ooo:com.sun.star.form.component.RadioButton" xml:id="control4" form:id="control4" form:label="Bouton radio" form:input-required="false" formx:group-name="toto" form:image-position="center">
                        <form:properties>
                            <form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.RadioButton"/>
                            <form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/>
                            <form:property form:property-name="SecondaryRefValue" office:value-type="string" office:string-value=""/>
                        </form:properties>
                    </form:radio>
                    <form:listbox form:name="Zone de liste 1" form:control-implementation="ooo:com.sun.star.form.component.ListBox" xml:id="control5" form:id="control5" form:dropdown="true" form:size="20" form:input-required="false" form:bound-column="1">
                        <form:properties>
                            <form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.ListBox"/>
                            <form:property form:property-name="MouseWheelBehavior" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/>
                            <form:list-property form:property-name="TypedItemList" office:value-type="float"/>
                        </form:properties>
                        <form:option form:label="a"/>
                        <form:option form:label="b"/>
                        <form:option form:label="c"/>
                    </form:listbox>
                    <form:listbox form:name="Zone de liste 1" form:control-implementation="ooo:com.sun.star.form.component.ListBox" xml:id="control6" form:id="control6" form:dropdown="true" form:size="20" form:input-required="false" form:bound-column="1" form:multiple="true">
                        <form:properties>
                            <form:property form:property-name="ControlTypeinMSO" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="DefaultControl" office:value-type="string" office:string-value="com.sun.star.form.control.ListBox"/>
                            <form:property form:property-name="MouseWheelBehavior" office:value-type="float" office:value="0"/>
                            <form:property form:property-name="ObjIDinMSO" office:value-type="float" office:value="65535"/>
                            <form:list-property form:property-name="TypedItemList" office:value-type="float"/>
                        </form:properties>
                        <form:option form:label="a"/>
                        <form:option form:label="b"/>
                        <form:option form:label="c"/>
                    </form:listbox>
                </form:form>
            </office:forms>

*/